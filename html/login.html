

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Auth Page</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script defer data-domain="form2chat.me" src="https://plausible.io/js/plausible.js"></script>

<style>
@import url("https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap");

body {
  font-family: 'Roboto', sans-serif;
  background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
  display: flex;

  background-image: url("https://twilead.com/wp-content/uploads/2025/04/formulaire-en-ligne-leads.jpg.jpg");
  justify-content: center;
  
  align-items: center;
  height: 100vh;
  margin: 0;
}

.container {
  position: relative; /* Needed for absolute positioning of children */
  background: #fff;
  border-radius: 16px;
  width: 100%;
  max-width: 400px;
  padding: 40px 32px;
  box-shadow: 0px 10px 40px rgba(0,0,0,0.1);
  animation: slideIn 0.6s ease-in-out;
  overflow: hidden; /* To keep the watermark inside */
}

.logo-container {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    opacity: 0.05;
    z-index: 0;
    pointer-events: none;
}

.logo-container img {
    width: 250px;
    height: auto;
}

/* Make sure form elements are on top of the watermark */
form {
    position: relative;
    z-index: 1;
    background-color: transparent; /* Ensure form background is not hiding the watermark */
}

@keyframes slideIn {
  from { opacity: 0; transform: translateY(-40px); }
  to { opacity: 1; transform: translateY(0); }
}

h1 {
  text-align: center;
  font-weight: 700;
  font-size: 28px;
  color: #333;
  margin-bottom: 10px;
}

h2 {
  text-align: center;
  margin-bottom: 28px;
  font-weight: 500;
  color: #555;
}

.input-field {
  position: relative;
  margin-bottom: 22px;
}
.input-field input {
  width:94%;
  padding: 14px 12px;
  border: 1.8px solid #ccc;
  border-radius: 8px;
  outline: none;
  font-size: 15px;
  background: #f9f9f9;
  transition: 0.3s ease;
}
.input-field label {
  position: absolute;
  left: 12px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 14px;
  color: #888;
  background: #f9f9f9;
  padding: 0 4px;
  pointer-events: none;
  transition: 0.25s ease;
}
.input-field input:focus {
  border-color: #007BFF;
  background: #fff;
  box-shadow: 0 0 8px rgba(0,123,255,0.2);
}
.input-field input:focus + label,
.input-field input:not(:placeholder-shown) + label {
  top: -8px;
  left: 10px;
  font-size: 12px;
  color: #007BFF;
  background: #fff;
}

button {
  width: 100%;
  padding: 12px;
  margin-top: 14px;
  border: none;
  border-radius: 8px;
  font-weight: 600;
  font-size: 15px;
  cursor: pointer;
  transition: 0.3s;
  position: relative;
  overflow: hidden;
}
button.primary {
  background: #007BFF;
  color: white;
}
button.primary:hover {
  background: #0056b3;
}
button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}
button.loading {
  opacity: 0.6;
  cursor: not-allowed;
}
button.google {
  background: #fff;
  color: #555;
  border: 1px solid #ddd;
}
button.google:hover {
  background: #f7f7f7;
}

button::after {
  content: "";
  position: absolute;
  width: 0;
  height: 0;
  border-radius: 50%;
  background: rgba(255,255,255,0.4);
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  transition: width 0.4s ease, height 0.4s ease;
}
button:active::after {
  width: 300px;
  height: 300px;
}

.switch {
  text-align: center;
  margin-top: 16px;
  font-size: 14px;
}
.switch a {
  color: #007BFF;
  font-weight: bold;
  cursor: pointer;
}

.message {
  text-align: center;
  font-size: 14px;
  margin-top: 8px;
}
.success { color: green; }
.error { color: red; }

@media (max-width: 420px) {
  .container {
    margin: 20px;
    padding: 25px;
  }
}
/* Google Sign-In Button container */
.g_id_signin {
  width: 100% !important;
  margin-top: 14px;
  border-radius: 8px !important;
  overflow: hidden;
  box-shadow: 0px 2px 6px rgba(0,0,0,0.12);
}

/* Ensure iframe inside fits nicely */
.g_id_signin iframe {
  width: 100% !important;
  border-radius: 8px;
}

/* Optional: match hover effect like your primary button */
.g_id_signin:hover {
  box-shadow: 0px 4px 10px rgba(0,0,0,0.16);
  transition: 0.2s ease;
}

</style>
</head>
<body>

<div class="container">
  <h1>Welcome to Form2Chat</h1>
  <div class="logo-container">
    <img src="https://lh3.googleusercontent.com/a/ACg8ocIU1JBzzHmQKxFc10ByX2jqUxv1mWc6U42O_2AcQICPutASiOrhh7h4PmXHTPBhGShe9i8XsVTsWjz0d9zZbPFzZDR4Yzk=s288-c-no" alt="logo">
  </div>
  
  
  <!-- Signup Form -->
  <form id="signupForm">
    <h2>Signup</h2>
    <div class="input-field">
      <input id="signupName" placeholder=" " required>
      <label for="signupName">Name</label>
    </div>
    <div class="input-field">
      <input id="signupEmail" type="email" placeholder=" " required>
      <label for="signupEmail">Email</label>
    </div>
    <div class="input-field">
      <input id="signupPassword" type="password" placeholder=" " required>
      <label for="signupPassword">Password</label>
    </div>
    <button type="submit" class="primary">Signup</button>
    <button type="button" class="google">Continue with Google</button>
    <p class="message" id="signupMsg"></p>
    <div class="switch">Already have an account? <a onclick="showLogin()">Login</a></div>
  </form>

  <!-- Login Form -->
  <form id="loginForm" style="display:none;">
    <h2>Login</h2>
    <div class="input-field">
      <input id="loginEmail" type="email" placeholder=" " required>
      <label for="loginEmail">Email</label>
    </div>
    <div class="input-field">
      <input id="loginPassword" type="password" placeholder=" " required>
      <label for="loginPassword">Password</label>
    </div>
    <button type="submit" class="primary">Login</button>
    <button type="button" class="google">Continue with Google</button>
    <p class="message" id="loginMsg"></p>
    <div class="switch">Don’t have an account? <a onclick="showSignup()">Signup</a></div>
    <div class="switch"><a onclick="showForgot()">Forgot Password?</a></div>
  </form>

  <!-- Forgot Password Form -->
  <form id="forgotForm" style="display:none;">
    <h2>Forgot Password</h2>
    <div class="input-field">
      <input id="forgotEmail" type="email" placeholder=" " required>
      <label for="forgotEmail">Email</label>
    </div>
    <button type="submit" class="primary">Send Reset Link</button>
    <p class="message" id="forgotMsg"></p>
    <div class="switch"><a onclick="showLogin()">Back to Login</a></div>
  </form>

  <!-- Reset Password Form -->
  <form id="resetForm" style="display:none;">
    <h2>Reset Password</h2>
    <div class="input-field">
      <input id="newPassword" type="password" placeholder=" " required>
      <label for="newPassword">New Password</label>
    </div>
    <button type="submit" class="primary">Reset Password</button>
    <p class="message" id="resetMsg"></p>
  </form>
</div>

<!-- Google SDK -->
<!-- Google SDK -->
<script src="https://accounts.google.com/gsi/client" async defer
        onload="initGoogle()"></script>


<script>
const API_URL = "https://api.form2chat.me/api/auth";
let token = localStorage.getItem("token") || "";
let googleInitialized = false;

// ==================== SHOW/HIDE FORMS ====================
function showLogin() {
  hideAll();
  document.getElementById("loginForm").style.display = "block";
}
function showSignup() {
  hideAll();
  document.getElementById("signupForm").style.display = "block";
}
function showForgot() {
  hideAll();
  document.getElementById("forgotForm").style.display = "block";
}
function showReset() {
  hideAll();
  document.getElementById("resetForm").style.display = "block";
}
function hideAll() {
  document.querySelectorAll("form").forEach(f => f.style.display="none");
}

// ==================== EMAIL VALIDATION ====================
function validateEmail(email) {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return emailRegex.test(email);
}

// ==================== VERIFY TOKEN ====================
async function verifyToken() {
  try {
    const res = await fetch(`${API_URL}/me`, { headers:{ "Authorization": token } });
    if(res.ok) window.location.href="allForms.html";
    else { localStorage.removeItem("token"); token=""; showLogin(); }
  } catch { showLogin(); }
}

// ==================== SIGNUP ====================
document.getElementById("signupForm").addEventListener("submit", async e => {
  e.preventDefault();
  const name = document.getElementById("signupName").value.trim();
  const email = document.getElementById("signupEmail").value.trim();
  const password = document.getElementById("signupPassword").value;

  const msg = document.getElementById("signupMsg");
  const btn = e.target.querySelector('button[type="submit"]');

  // Validate email
  if (!validateEmail(email)) {
    msg.innerText = "Please enter a valid email address.";
    msg.className = "message error";
    return;
  }

  // Disable button
  btn.disabled = true;
  btn.innerText = "Signing up...";

  try {
    const res = await fetch(`${API_URL}/signup`, {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({ name, email, password })
    });
    const data = await res.json();

    if (data.token) {
      token = data.token;
      localStorage.setItem("token", token);
      if (data.user && data.user.id) {
        localStorage.setItem("userId", data.user.id);
      }
      msg.innerText = "Signup successful ✅";
      msg.className = "message success";
      setTimeout(() => window.location.href = "allForms.html", 600);
    } else {
      msg.innerText = data.msg || data.message || "Signup failed. Please try again.";
      msg.className = "message error";
    }
  } catch (error) {
    msg.innerText = "An error occurred. Please try again.";
    msg.className = "message error";
  } finally {
    // Re-enable button
    btn.disabled = false;
    btn.innerText = "Signup";
  }
});

// ==================== LOGIN ====================
document.getElementById("loginForm").addEventListener("submit", async e => {
  e.preventDefault();
  const email = document.getElementById("loginEmail").value.trim();
  const password = document.getElementById("loginPassword").value;

  const msg = document.getElementById("loginMsg");
  const btn = e.target.querySelector('button[type="submit"]');

  // Validate email
  if (!validateEmail(email)) {
    msg.innerText = "Please enter a valid email address.";
    msg.className = "message error";
    return;
  }

  // Disable button
  btn.disabled = true;
  btn.innerText = "Logging in...";

  try {
    const res = await fetch(`${API_URL}/login`, {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({ email, password })
    });
    const data = await res.json();

    if (data.token) {
      token = data.token;
      localStorage.setItem("token", token);
      if (data.user && data.user.id) {
        localStorage.setItem("userId", data.user.id);
      }
      msg.innerText = "Login successful ✅";
      msg.className = "message success";
      setTimeout(() => window.location.href = "allForms.html", 600);
    } else {
      msg.innerText = data.msg || data.message || "Invalid email or password.";
      msg.className = "message error";
    }
  } catch (error) {
    msg.innerText = "An error occurred. Please try again.";
    msg.className = "message error";
  } finally {
    // Re-enable button
    btn.disabled = false;
    btn.innerText = "Login";
  }
});

// ==================== FORGOT PASSWORD ====================
document.getElementById("forgotForm").addEventListener("submit", async e => {
  e.preventDefault();
  const email = document.getElementById("forgotEmail").value;

  const res = await fetch(`${API_URL}/forgot-password`, {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ email })
  });
  const data = await res.json();
  const msg = document.getElementById("forgotMsg");
  msg.innerText = data.message || JSON.stringify(data);
  msg.className = data.message?.toLowerCase().includes("sent") ? "message success" : "message error";
});

// ==================== RESET PASSWORD ====================
document.getElementById("resetForm").addEventListener("submit", async e => {
  e.preventDefault();
  const password = document.getElementById("newPassword").value;
  const token = new URLSearchParams(window.location.search).get("token");

  if(!token) {
    alert("Invalid reset link");
    return;
  }

  const res = await fetch(`${API_URL}/reset-password/${token}`, {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ password })
  });
  const data = await res.json();
  const msg = document.getElementById("resetMsg");
  msg.innerText = data.message || JSON.stringify(data);
  msg.className = data.message?.toLowerCase().includes("successful") ? "message success" : "message error";
});

// ==================== GOOGLE LOGIN ====================
function initGoogle() {
  if (!window.google) return;

  google.accounts.id.initialize({
    client_id: "787802625562-e4j7crtfh672b0kh1gcn4ncpncq5tvot.apps.googleusercontent.com",
    callback: handleCredentialResponse,
    ux_mode: "popup"
  });

  // Render Google button
  document.querySelectorAll(".google").forEach(btn => {
    btn.innerHTML = "";
    google.accounts.id.renderButton(btn, {
      theme: "outline",
      size: "large",
      shape: "pill",
      text: "continue_with",
      width: 300 // ✅ must be a number, not "100%"
    });
  });
}

function handleCredentialResponse(response) {
  fetch(`${API_URL}/google`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ token: response.credential })
  })
  .then(res => res.json())
  .then(data => {
 if (data.user.id) {
      // ✅ userId को localStorage में save करो
      localStorage.setItem("userId", data.user.id);

      // console.log("User ID stored:", localStorage.getItem("userId"));
    }
    console.log("Google login response:", data);
    if (data.token) {
      localStorage.setItem("token", data.token);

      window.location.href = "allForms.html";
    } else {
      alert("Google login failed!");
    }
  })
  .catch(() => alert("Google login failed!"));
}
// ==================== ON LOAD ====================
window.addEventListener("load", async ()=>{
  initGoogle();

  // Check if reset link opened
  const resetToken = new URLSearchParams(window.location.search).get("token");
  if(resetToken){
    showReset();
  } else {
    // Check localStorage token for auto-login
    const localToken = localStorage.getItem("token");
    if(localToken){
      // verify token with API
      const res = await fetch(`${API_URL}/me`, {
        headers: { "Authorization": `Bearer ${localToken}` }
      });

      if(res.ok){
        // valid token → auto redirect
        window.location.href = "allForms.html";
      } else {
        // invalid token → clear storage + show login
        localStorage.removeItem("token");
        showLogin();
      }
    } else {
      // no token → show login
      showLogin();
    }
  }
});

</script>
</body>
</html>
